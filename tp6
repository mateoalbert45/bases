No se que copie xd pero supongo que me va  servir


para hcer una restriccion declarativa tengo que buscar lo que esta mal y poner un not exists


alter table contiene add constraint chk_ejemplo
check_no exits(
select 1 
from contiene
group by cod_palabra, idioma
having vount (*) > 5))

create or replace function ejemplo_palabrfa () returns trigger as $body$
begin if(exists( select 1 
from contiene c
where c.cod_palabra = new.cod_palabra and c.idioma = new.idioma
group by cod_palabra, idioma
having vount (*) > 5)) then
raise excepcion 'palabra en mas de 5 articulos'
end if;
return new;
end;


create trigger nombre
after insert or update on contiene for each row execute procedure...;

ejercicio 2.1
CREATE DOMAIN  sueldoValido 
sueldo_maximo numeric(7,2)
CHECK (sueldo_maximo > sueldo_minimo);

ejercicio 2.2
alter table empleado add constraint cantidadEmpleados
check not exists(
select 1
from empleado 
group by id_departamento, id_distribuidor
having count(id_empleado) > 70
)
ejercicio 2.3
CREATE ASSERTION  JefesMismoDepartamento CHECK not exists(select *
from empleado e join empleado j on(e.id_jefe = j.id_empleado)
where e.id_departamento = j.id_departamento and e.id_distribuidor = j.id_distribuidor
order by e.id_empleado
limit 100);
ejercicio 2.4
CREATE ASSERTION IdiomasEntregas CHECK not exists(select 1
from pelicula p join renglon_entrega re on (p.codigo_pelicula = re.codigo_pelicula)
group by re.nro_entrega
having count(distinct p.idioma) > 1
limit 100
)
ejercicio 2.5
alter table empresa_productora add constraint cantidadEmpresasPorCiudad
check(
select id_ciudad, count(codigo_productora)
from empresa_productora
group by id_ciudad
having count(codigo_productora) > 10
)
ejercicio 2.6
alter table pelicula add constraint 8mm
check(
(formato = '8mm' and idioma = 'FrancÃ©s') or formato != '8mm'
)
esto es que si el formato es 8mm el idioma tiene que ser frances, y que si el formato no es asi da igual, o sea entra cualquier cosa
:)

******
ACLARACION (dou)
cuando se hacen checks de fila o de un solo atributo se usa  el check( "condicion" ), y solo cuando es un check de tabla o assertion
se usa el check not exists(consulta)
******
ejercicio 2.7
alter table distribuidor add constraint numTelefono
check not exists(
select *
from distribuidor d
where substring (d.telefono, 1, 3) =(select substring (d1.telefono, 1, 3) from nacional n, distribuidor d1
where n.id_distribuidor = d.id_distribuidor
and d1.id_distribuidor = n.id_distrib_mayorista
limit 100
)
ejercicio 2.8
alter table entrega add constraint fecha
check(
fecha_entrega >= CURRENT_DATE
)



